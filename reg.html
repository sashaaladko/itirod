<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Photo Gallery</title>
    <link rel="stylesheet" href="logandreg.css">
    <link rel="stylesheet" href="headerfooter.css">
</head>

<body>
    <header>
        <a href="start.html" class="logo"><img src="img/logo2.png"></a>
        <ul class="headermenu">
            <li class="headerlist"><a class="login" href="log.html">log in</a></li>
            <li class="headerlist"><a class="signup" href="reg.html">Sign up</a></li>
        </ul>
    </header>

    <main>
        <div class="register-form-container">

                <h1 class="form-title"> Sign in to Photo Gallery</h1>
                <div class="form-fields">
                        <input id="email" class="form-field" type="username" placeholder="email">
                        <input id="password" class="form-field" type="password" placeholder="Password" maxlength="128">
                </div>
                <div class="form-buttons">
                    <button id="logbtn" class="button">Sign in</button>
                </div>

        </div>
    </main>

    <footer>
        <div class="socials">
            <a target="_blank" href="https://instagram.com/lohushkam_mimo">
                <img class="socials" src="img/instagram1.gif" title="instagram: lohushkam_mimo">
            </a>
        </div>
            <p class="copyryght">
                Copyright 2022 - All Rights Resetved
            </p>

    </footer>
</body>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-app.js";

    import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        signOut
    } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-auth.js";
    import {getDatabase, set, ref, update} from "https://www.gstatic.com/firebasejs/9.8.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA9SHAbyOkqZ6zc22UgRCjnq-WDmKbpszw",
      authDomain: "myproject-4e14b.firebaseapp.com",
      projectId: "myproject-4e14b",
      storageBucket: "myproject-4e14b.appspot.com",
      messagingSenderId: "771130468719",
      appId: "1:771130468719:web:94f26da9f7c85ccbea209a"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const database = getDatabase(app);

    
    var submitData = document.getElementById('logbtn');

    submitData.addEventListener('click', (e) => {

        var email = document.getElementById('email').value;
        var password = document.getElementById('password').value;


        signInWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {

                const user = userCredential.user;

                var lgDate = new Date();
                update(ref(database, 'users/' + user.uid), {
                    last_login: lgDate,
                })
                    .then(() => {
                        alert('user logged in successfully');
                        document.location='start.html';
                    })
                    .catch((error) => {
                        alert(error);
                    });
            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                alert(errorMessage);
            });


        signOut(auth).then(() => {
        }).catch((error) => {
        });
    });

  </script>

</html>
